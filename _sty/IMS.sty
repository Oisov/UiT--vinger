% ==============================================================================
% ==============================================================================
%           _____                    _____                    _____          
%          /\    \                  /\    \                  /\    \         
%         /::\    \                /::\____\                /::\    \        
%         \:::\    \              /::::|   |               /::::\    \       
%          \:::\    \            /:::::|   |              /::::::\    \      
%           \:::\    \          /::::::|   |             /:::/\:::\    \     
%            \:::\    \        /:::/|::|   |            /:::/__\:::\    \    
%            /::::\    \      /:::/ |::|   |            \:::\   \:::\    \   
%   ____    /::::::\    \    /:::/  |::|___|______    ___\:::\   \:::\    \  
%  /\   \  /:::/\:::\    \  /:::/   |::::::::\    \  /\   \:::\   \:::\    \ 
% /::\   \/:::/  \:::\____\/:::/    |:::::::::\____\/::\   \:::\   \:::\____\
% \:::\  /:::/    \::/    /\::/    / ~~~~~/:::/    /\:::\   \:::\   \::/    /
%  \:::\/:::/    / \/____/  \/____/      /:::/    /  \:::\   \:::\   \/____/ 
%   \::::::/    /                       /:::/    /    \:::\   \:::\    \     
%    \::::/____/                       /:::/    /      \:::\   \:::\____\    
%     \:::\    \                      /:::/    /        \:::\  /:::/    /    
%      \:::\    \                    /:::/    /          \:::\/:::/    /     
%       \:::\    \                  /:::/    /            \::::::/    /      
%        \:::\____\                /:::/    /              \::::/    /       
%         \::/    /                \::/    /                \::/    /        
%          \/____/                  \/____/                  \/____/     
% 
% ==============================================================================
% ==============================================================================
%
\newcommand{\instituteNameNorsk}{Institutt for matematikk og statistikk}
\newcommand{\instituteNameEnglish}{Department of Mathematics and Statistics}
\newcommand{\instituteNameNynorsk}{Institutt for matematikk og statistikk}
\newcommand{\instituteNameSamin}{Matematihka ja statistihka instituhtta}

% ==============================================================================
%          Contact
% ==============================================================================

%   http://www.korrekturavdelingen.no/tall-siffer-gruppering.htm
%   PT, Forbrukerombudet og Telenor har gitt en anbefaling 
%   om at fasttelefonnumre skrives med to og to sifre sammen, dvs. 2 2 2 2, 
%   mens mobilnumre skrives 3 2 3, på samme måte som 8xx-serien. 
%   Det understrekes imidlertid at dette kun er en anbefaling.
%
%   Post- og teletilsynet

\newcommand{\OlaLov}{Ola Løvsletten \\ 415 79 069}
\newcommand{\OlgaLyc}{Olga Lychagina \\ 452 69 303}
\newcommand{\MariusOve}{Marius Overholt \\ 954 23 735 // 77 64 40 22}
\newcommand{\TrygveJoh}{Trygve Johnsen \\ 928 91 913 // 77 64 40 31}
\newcommand{\MartinRyp}{Martin Rypdal \\ 901 75 4221}
\newcommand{\KristofferRyp}{Kristoffer Rypdal \\ 477 12 863}
\newcommand{\RagnarSol}{Ragnar Soleng \\ 995 62 051 // 77 64 40 14}
\newcommand{\HegeFre}{Hege-Beate Fredriksen \\ 404 80 750}
\newcommand{\AndreiPra}{Andrei Prasolov  \\ 936 75 832}
\newcommand{\BorisKru}{Boris Kruglikov \\ 938 02 163}
\newcommand{\DennisThe}{Dennis The \\ 486 19 640 // 77 64 55 01}
\newcommand{\EivindSch}{Eivind Schneider \\ 476 39 201}
\newcommand{\PerKJak}{Per Kristen Jakobsen \\ 77 64 40 201}
\newcommand{\TorFlaa}{Tor Flå\\ 45 22 16 57}
\newcommand{\EinarMjo}{Einar Mjølhus\\77 68 76 48}

\defineInfo{olalov}{
  name=Ola Løvsletten, mobile=41579069, 
}
\defineInfo{olgalyc}{
  name=Jane Doe, mobile=452 69 303,
}
\defineInfo{mariusove}{
  name=Marius Overholt, phone=77644022, mobile=95423735,
}
\defineInfo{trygvejoh}{
  name=Trygve Johnsen, phone=77644031, mobile=92891913,
}
\defineInfo{martinryp}{
  name=Martin Rypdal, mobile=47712863,
}
\defineInfo{kristofferryp}{
  name=Kristoffer Rypdal, mobile=47712863,
}
\defineInfo{ragnarsol}{
  name=Ragnar Soleng, phone=77644014, mobile=99562051,
}
\defineInfo{hegefre}{
  name=Hege-Beate Fredriksen, mobile=40480750,
}
\defineInfo{andreipra}{
  name=Andrei Prasolov, mobile=93675832,
}
\defineInfo{boriskru}{
  name=Boris Kruglikov, mobile=93802163,
}
\defineInfo{dennisthe}{
  name=Dennis The, phone=77645501, mobile=48619640,
}
\defineInfo{eivindsch}{
  name=Eivind Schneider, mobile=47639201,
}
\defineInfo{perjak}{
  name=Per Kristen Jakobsen, phone=33123123, mobile=92132132,
}
\defineInfo{torflaa}{
  name=Tor Flå, mobile=45221657,
}
\defineInfo{einarmjo}{
  name=Einar Mjølhus, phone=77687648,
}

% ==============================================================================
%          Approved Aids
% ==============================================================================

% Swtchlang switches between English, Bokmål, Nynorsk, and Samin (Nord Samisk).

\newcommand{\rottmann}{%
    \switchLang{Rottmann’s tables}%
               {Rottmanns tabeller}%
               {Rottmanns tabellar}%
               {Rottmanns tabeallah}%
}
\newcommand{\kalkulator}{%
    \switchLang{calculator}{kalkulator}{kalkulator}{kalkuláhtor}%
}
\newcommand{\Kalkulator}{%
    \switchLang{Calculator}{Kalkulator}{Kalkulator}{Kalkuláhtor}%
}
\newcommand{\bestemtKalkulator}{%
    \switchLang{Specific basic}%
               {Bestemt enkel}%
               {Bestemt enkel}%
               {}%
               ~\kalkulator%
}
\newcommand{\alleTrykte}{%
    \switchLang{All printed and hand-written support material}%
               {Alle trykte og skrevne}%
               {Alle trykte og skrevne}{}%
}
\newcommand{\egneNotater}{%
    \switchLang{Own handwritten notes on two 
                A4-size papers (both sides: 4 pages)}%
               {To A4-ark (4 sider) med egne notater}%
               {To A4-ark (4 sider) med eigne notat}%
               {}%
}
\newcommand{\punktSymbol}{--}

\ExplSyntaxOn

\NewDocumentCommand{\supportMaterial}{m}
 {
  \begin{supportMaterialList}[label={--}]
  \nebuch_supportmaterials:n { #1 }
  \end{supportMaterialList}
 }

\clist_new:N \l__nebuch_supportmaterials_clist

\cs_new_protected:Nn \nebuch_supportmaterials:n
 {
  \clist_set:Nn \l__nebuch_supportmaterials_clist { #1 }
  \clist_remove_duplicates:N \l__nebuch_supportmaterials_clist
  \clist_sort:Nn \l__nebuch_supportmaterials_clist
   {
    \int_compare:nTF { `##1 > `##2 }
     { \sort_return_swapped: }
     { \sort_return_same: }
   }
  \clist_map_function:NN \l__nebuch_supportmaterials_clist \__nebuch_supportmaterials_print:n
 }

\cs_new_protected:Nn \__nebuch_supportmaterials_print:n
 {
  \item 
  \str_case:nn { #1 }
   {
    {r}{\rottmann}%
    {b}{\bestemtKalkulator}%
    {k}{\Kalkulator}%
    {c}{\Kalkulator}%
    {a}{\alleTrykte}%
    {e}{\egneNotater}%
   }
 }
\ExplSyntaxOff

%
% A: All printed and hand-written support material is allowed. 
%    All calculators are allowed.
\newcommand{\supportMaterialA}{%
    \supportMaterial{a, k}
}
% B: All printed and hand-written support material is allowed. 
%    A specific basic calculator is allowed.
\newcommand{\supportMaterialB}{%
    \supportMaterial{a, b}
}
% C: Specified printed and hand-written support material is allowed. 
%    A specific basic calculator is allowed.
\newcommand{\supportMaterialC}{%
    \supportMaterial{b, r, e}
}
% D: No printed or hand-written support material is allowed. 
%    A specific basic calculator is allowed.
\newcommand{\supportMaterialD}{%
    \supportMaterial{b}
}
% E: No support material is allowed.
\newcommand{\supportMaterialE}{%
}
% F: Specified printed and hand-written support material is allowed. 
%    No calculators are allowed.
\newcommand{\supportMaterialF}{%
    \punktSymbol~\rottmann, \\
    \punktSymbol~\egneNotater
}



% ==============================================================================
%          Places
% ==============================================================================

\newcommand{\audmax}{Administrasjonsbygget, AUD MAX}
\newcommand{\aasgard}{Åsgardveien 9}
\newcommand{\teorifag}{Teorifagbygget, hus 1, plan}
\DeclareDocumentCommand{\admB}{G{B154}}{Administrasjonsbygget, #1}


% ==============================================================================
%          Packages
% ==============================================================================

\usepackage{environ} % Needed for the transpose magic

% Needed for differentials
\usepackage{esdiff} % http://mirrors.ctan.org/macros/latex/contrib/esdiff/esdiff.pdf
%
% Example: 
%                          dx
% \diff{x}{y}     |        dy
%                 |
% \diffp{x}{y}    |        \partial x
%                 |        \partial y
%                 |
%                 |        dx2
% \diff[2]{x}{y}  |        d2y

% ==============================================================================
%          Sets
% ==============================================================================

\newcommand{\CC}{\mathbb{C}} % Complex
\newcommand{\N}{\mathbb{N}}  % Naturals
\newcommand{\Q}{\mathbb{Q}}  % Rationals
\newcommand{\R}{\mathbb{R}}  % Reals
\newcommand{\Z}{\mathbb{Z}}  % Integers
\newcommand{\T}{\mathbb{T}}  % Circle, points satisfying |e^{iz}| = 1


% ==============================================================================
%          Operators
% ==============================================================================

\DeclareMathOperator{\cond}{cond} % conditional number (numerical approximations)
\DeclareMathOperator{\Res}{Res} % residue (complex analysis)
\DeclareMathOperator{\linspan}{linspan} % linear span (functional analysis)
\DeclareMathOperator{\ord}{ord} % order (Number theory)

% ==============================================================================
%          Delimiters
% ==============================================================================
%
% Use \abs{#1} for |#1| and \abs*{#1} for \left| #1 \right|
\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}% 

% Use \inp{1}{2} to make <1, 2>  change , to | below if need be
\DeclarePairedDelimiterX{\inp}[2]{\langle}{\rangle}{#1, #2}

% The code below allows one to write \Set{} and \Set{ a \given b } 
% to respectively give {} and {a | b} use \Set* to scale parenthesis
\providecommand\given{}

\newcommand\SetSymbol[1][]{
    \nonscript\:#1\vert
    \allowbreak
    \nonscript\:
    \mathopen{}}

\DeclarePairedDelimiterX\Set[1]\{\}{
    \renewcommand\given{\SetSymbol[\delimsize]}
    #1
}
% ==============================================================================
%          Symbol definitions
% ==============================================================================

\newcommand{\e}{\mathrm{e}} % Eulers number e=2.718281828.. is a constant, and should thus, NOT be slanted
\newcommand{\im}{\mathrm{i}} % Similarly the imaginary unit i should NOT be slanted
\newcommand{\jm}{\mathrm{j}}

\newcommand{\an}[1]{\widetilde{#1}} % How analytic extension of a function should look
\newcommand{\conj}[1]{\overline{#1}} % How complex conjugates should look

\newcommand*{\tran}{^{\mkern-1.5mu\mathsf{T}}} % Matrix transpose symbol

\newcommand{\Riemann}{\widehat{\CC}} % Riemansphere
\newcommand{\RiemannDef}{\Riemann = \mathbb{C} \cup \{ \infty \}}

\newcommand{\fourier}[1]{\widehat{#1}} % How the fouriercoefficient should look
\newcommand{\oper}[1]{\widehat{#1}} % How to define operators

\newcommand{\euler}{\varphi} % Defines how to display Euler's totient function

% Defines that sexy Legendre symbol
% https://tex.stackexchange.com/questions/20361/legendre-symbol-in-theory-of-numbers
\makeatletter
    \def\legendre@dash#1#2{\hb@xt@#1{%
      \kern-#2\p@
      \cleaders\hbox{\kern.5\p@
        \vrule\@height.2\p@\@depth.2\p@\@width\p@
        \kern.5\p@}\hfil
      \kern-#2\p@
      }}
    \def\@legendre#1#2#3#4#5{\mathopen{}\left(
      \sbox\z@{$\genfrac{}{}{0pt}{#1}{#3#4}{#3#5}$}%
      \dimen@=\wd\z@
      \kern-\p@\vcenter{\box0}\kern-\dimen@\vcenter{\legendre@dash\dimen@{#2}}\kern-\p@
      \right)\mathclose{}}
    \newcommand\legendre[2]{\mathchoice
      {\@legendre{0}{1}{}{#1}{#2}}
      {\@legendre{1}{.5}{\vphantom{1}}{#1}{#2}}
      {\@legendre{2}{0}{\vphantom{1}}{#1}{#2}}
      {\@legendre{3}{0}{\vphantom{1}}{#1}{#2}}
    }
    \def\dlegendre{\@legendre{0}{1}{}}
    \def\tlegendre{\@legendre{1}{0.5}{\vphantom{1}}}
\makeatother


% ==============================================================================
%          Differentials
% ==============================================================================

% Defines a \dd to be used in differentials. e.g \dd x
% According to the ISO standard the d in dx should not be slanted
\makeatletter
    \newcommand*{\dd}{\mathop{}\!{\operator@font d}}
\makeatother

% Differentials
\newcommand{\da}{\dd a}
\newcommand{\db}{\dd b}
\newcommand{\dc}{\dd c}

\newcommand{\de}{\dd e}
\newcommand{\df}{\dd f}
\newcommand{\dg}{\dd g}
% \newcommand{\dh}{\dd h}
\newcommand{\di}{\dd i}
% \newcommand{\dj}{\dd j}
\newcommand{\dk}{\dd k}
\newcommand{\dl}{\dd l}
\newcommand{\dm}{\dd m}
% \newcommand{\do}{\dd o}
% \newcommand{\dp}{\dd p}
% \newcommand{\dq}{\dd q}
\newcommand{\dr}{\dd r}
\newcommand{\ds}{\dd s}
\newcommand{\dt}{\dd t}
\newcommand{\du}{\dd u}
\newcommand{\dv}{\dd v}
\newcommand{\dw}{\dd w}
\newcommand{\dx}{\dd x}
\newcommand{\dy}{\dd y}
\newcommand{\dz}{\dd z}

% Greek differentials
\newcommand{\dalpha}{\dd \alpha}
\newcommand{\dbeta}{\dd \beta}
\newcommand{\dgamma}{\dd \gamma}
\newcommand{\ddelta}{\dd \delta}
\newcommand{\depsilon}{\dd \varepsilon}
\newcommand{\dzeta}{\dd \zeta}
\newcommand{\deta}{\dd \eta}
\newcommand{\dtheta}{\dd \theta}
\newcommand{\diota}{\dd \iota}
\newcommand{\dkappa}{\dd \kappa}
\newcommand{\dlambda}{\dd \lambda}
\newcommand{\dmu}{\dd \mu}
\newcommand{\dxi}{\dd \xi}
\newcommand{\drho}{\dd \rho}
\newcommand{\dsigma}{\dd \sigma}
\newcommand{\dtau}{\dd \tau}
\newcommand{\dupsilon}{\dd \upsilon}
\newcommand{\dphi}{\dd \varphi}
\newcommand{\dchi}{\dd \chi}
\newcommand{\dpsi}{\dd \psi}
\newcommand{\domega}{\dd \omega}

% ==============================================================================
%          Vectors
% ==============================================================================

\newcommand{\vek}[1]{\mathbf{#1}}

\newcommand{\vnull}{\vek{0}}
\newcommand{\va}{\vek{a}}
\newcommand{\vb}{\vek{b}}
\newcommand{\vc}{\vek{c}}
\newcommand{\vd}{\vek{d}}
\newcommand{\ve}{\vek{e}}
\newcommand{\vf}{\vek{f}}
\newcommand{\vg}{\vek{g}}
\newcommand{\vh}{\vek{h}}
\newcommand{\vi}{\vek{i}}
\newcommand{\vj}{\vek{j}}
\newcommand{\vk}{\vek{k}}
\newcommand{\vl}{\vek{l}}
\newcommand{\vm}{\vek{m}}
\newcommand{\vn}{\vek{n}}
\newcommand{\vo}{\vek{o}}
\newcommand{\vp}{\vek{p}}
\newcommand{\vq}{\vek{q}}
\newcommand{\vr}{\vek{r}}
\newcommand{\vs}{\vek{s}}
\newcommand{\vt}{\vek{t}}
\newcommand{\vu}{\vek{u}}
\newcommand{\vv}{\vek{v}}
\newcommand{\vw}{\vek{w}}
\newcommand{\vx}{\vek{x}}
\newcommand{\vy}{\vek{y}}
\newcommand{\vz}{\vek{z}}
\newcommand{\vA}{\vek{A}}
\newcommand{\vB}{\vek{B}}
\newcommand{\vC}{\vek{C}}
\newcommand{\vD}{\vek{D}}
\newcommand{\vE}{\vek{E}}
\newcommand{\vF}{\vek{F}}
\newcommand{\vG}{\vek{G}}
\newcommand{\vH}{\vek{H}}
\newcommand{\vI}{\vek{I}}
\newcommand{\vJ}{\vek{J}}
\newcommand{\vK}{\vek{K}}
\newcommand{\vL}{\vek{L}}
\newcommand{\vM}{\vek{M}}
\newcommand{\vN}{\vek{N}}
\newcommand{\vO}{\vek{O}}
\newcommand{\vP}{\vek{P}}
\newcommand{\vQ}{\vek{Q}}
\newcommand{\vR}{\vek{R}}
\newcommand{\vS}{\vek{S}}
\newcommand{\vT}{\vek{T}}
\newcommand{\vU}{\vek{U}}
\newcommand{\vV}{\vek{V}}
\newcommand{\vW}{\vek{W}}
\newcommand{\vX}{\vek{X}}
\newcommand{\vY}{\vek{Y}}
\newcommand{\vZ}{\vek{Z}}


% ==============================================================================
%          Matrices
% ==============================================================================
%
%
%
\DeclareDocumentCommand{\mat}{s O{} m}{%
    \IfBooleanTF{#1}{%
          \ifthenelse{\equal{#2}{r}}%
            {\begin{bmatrixTR}#3\end{bmatrixTR}}%
            {\begin{bmatrixT}#3\end{bmatrixT}}%
    }{%
        \ifthenelse{\equal{#2}{r}}%
            {\begin{bmatrix*}[r]#3\end{bmatrix*}}%
            {\begin{bmatrix}#3\end{bmatrix}}%
    }
}

% Creates the helper environment bmatrixT
% this transposes matrices
%
% \begin{bmatrix}   
%   1 & 0 & 0 \\      [ 0  0  1] 
%   0 & 1 & 0 \\   =  [ 0  1  0]
%   0 & 0 & 1         [ 1  0  0]
% \end{bmatrix}

\ExplSyntaxOn
\NewEnviron{bmatrixT}
 {
  \marine_transpose:V \BODY
 }

\int_new:N \l_marine_transpose_row_int
\int_new:N \l_marine_transpose_col_int
\seq_new:N \l_marine_transpose_rows_seq
\seq_new:N \l_marine_transpose_arow_seq
\prop_new:N \l_marine_transpose_matrix_prop
\tl_new:N \l_marine_transpose_last_tl
\tl_new:N \l_marine_transpose_body_tl

\cs_new_protected:Nn \marine_transpose:n
 {
  \seq_set_split:Nnn \l_marine_transpose_rows_seq { \\ } { #1 }
  \int_zero:N \l_marine_transpose_row_int
  \prop_clear:N \l_marine_transpose_matrix_prop
  \seq_map_inline:Nn \l_marine_transpose_rows_seq
   {
    \int_incr:N \l_marine_transpose_row_int
    \int_zero:N \l_marine_transpose_col_int
    \seq_set_split:Nnn \l_marine_transpose_arow_seq { & } { ##1 }
    \seq_map_inline:Nn \l_marine_transpose_arow_seq
     {
      \int_incr:N \l_marine_transpose_col_int
      \prop_put:Nxn \l_marine_transpose_matrix_prop
       {
        \int_to_arabic:n { \l_marine_transpose_row_int }
        ,
        \int_to_arabic:n { \l_marine_transpose_col_int }
       }
       { ####1 }
     }
   }
   \tl_clear:N \l_marine_transpose_body_tl
   \int_step_inline:nnnn { 1 } { 1 } { \l_marine_transpose_col_int }
    {
     \int_step_inline:nnnn { 1 } { 1 } { \l_marine_transpose_row_int }
      {
       \tl_put_right:Nx \l_marine_transpose_body_tl
        {
         \prop_item:Nn \l_marine_transpose_matrix_prop { ####1,##1 }
         \int_compare:nF { ####1 = \l_marine_transpose_row_int } { & }
        }
      }
     \tl_put_right:Nn \l_marine_transpose_body_tl { \\ }
    }
   \begin{bmatrix}
   \l_marine_transpose_body_tl
   \end{bmatrix}
 }
\cs_generate_variant:Nn \marine_transpose:n { V }
\cs_generate_variant:Nn \prop_put:Nnn { Nx }
\ExplSyntaxOff

\ExplSyntaxOn
    \NewEnviron{bmatrixTR}
     {
      \marine_transpose_two:V \BODY
     }
    
    \int_new:N \l_marine_transpose_row_int_two
    \int_new:N \l_marine_transpose_col_int_two
    \seq_new:N \l_marine_transpose_rows_seq_two
    \seq_new:N \l_marine_transpose_arow_seq_two
    \prop_new:N \l_marine_transpose_matrix_prop_two
    \tl_new:N \l_marine_transpose_last_tl_two
    \tl_new:N \l_marine_transpose_body_tl_two
    
    \cs_new_protected:Nn \marine_transpose_two:n
     {
      \seq_set_split:Nnn \l_marine_transpose_rows_seq_two { \\ } { #1 }
      \int_zero:N \l_marine_transpose_row_int_two
      \prop_clear:N \l_marine_transpose_matrix_prop_two
      \seq_map_inline:Nn \l_marine_transpose_rows_seq_two
       {
        \int_incr:N \l_marine_transpose_row_int_two
        \int_zero:N \l_marine_transpose_col_int_two
        \seq_set_split:Nnn \l_marine_transpose_arow_seq_two { & } { ##1 }
        \seq_map_inline:Nn \l_marine_transpose_arow_seq_two
         {
          \int_incr:N \l_marine_transpose_col_int_two
          \prop_put:Nxn \l_marine_transpose_matrix_prop_two
           {
            \int_to_arabic:n { \l_marine_transpose_row_int_two }
            ,
            \int_to_arabic:n { \l_marine_transpose_col_int_two }
           }
           { ####1 }
         }
       }
       \tl_clear:N \l_marine_transpose_body_tl_two
       \int_step_inline:nnnn { 1 } { 1 } { \l_marine_transpose_col_int_two }
        {
         \int_step_inline:nnnn { 1 } { 1 } { \l_marine_transpose_row_int_two }
          {
           \tl_put_right:Nx \l_marine_transpose_body_tl_two
            {
             \prop_item:Nn \l_marine_transpose_matrix_prop_two { ####1,##1 }
             \int_compare:nF { ####1 = \l_marine_transpose_row_int_two } { & }
            }
          }
         \tl_put_right:Nn \l_marine_transpose_body_tl_two { \\ }
        }
        \begin{bmatrix*}[r]
       \l_marine_transpose_body_tl_two
       \end{bmatrix*}%
     }
    \cs_generate_variant:Nn \marine_transpose_two:n { V }
    \cs_generate_variant:Nn \prop_put:Nnn { Nx }
\ExplSyntaxOff


% ==============================================================================
%          Modulo
% ==============================================================================

% Short hand for writing modular expressions
%
%  Input              |    Output
%  ----------------------------
%  \mmod{3}{n}        |         3 (mod n)    
%  \mmod{x}{3}{n}     |   x   = 3 (mod n)  
%  \mmod[&]{x}{3}{n}  |   x & = 3 (mod n)  
%  ----------------------------
\DeclareDocumentCommand{\mmod}{O{} m m g}{%
        \IfNoValueTF{#4}%
            {#2\bmod{#3}}%
            {#2#1\equiv#3\bmod{#4}}%
}


% ==============================================================================
%          Limits, Sums and Integrals
% ==============================================================================
%          Limits
% ==============================================================================

% Short hand for writing limits to infinity
%
%  Input        |    Output
%  ----------------------------
%  \limN        |   \lim_{n ->   \infty}
%  \limN*       |   \lim_{n -> - \infty}
%  \limN{k}     |   \lim_{k ->   \infty}
%  \limN*{k}    |   \lim_{k -> - \infty}
%  ----------------------------
\NewDocumentCommand\limN{s G{n} G{\infty}}{%
    \lim_{#2\to\IfBooleanTF{#1}{-}{}#3}%
}

\NewDocumentCommand\limK{s G{k} G{\infty}}{%
    \lim_{#2\to\IfBooleanTF{#1}{-}{}#3}%
}


% ==============================================================================
%          Sums
% ==============================================================================

% Defines a sum over the naturals
%
%  Input        |    Output
%  ----------------------------
%  \sumN        |   \sum_{n = 1}^\infty
%  \sumN*       |   \sum_{n = 0}^\infty
%  \sumN{r}     |   \sum_{r = 1}^\infty
%  \sumN*{r}    |   \sum_{r = 0}^\infty
%  ----------------------------
\NewDocumentCommand\sumN{s G{n}}{%
    \sum_{#2 = \IfBooleanTF{#1}{0}{1}}^{\infty}
}

% These are just because I am incredibly lazy...
%
%  Input        |    Output
%  ----------------------------
%  \sumK        |   \sum_{k = 1}^\infty
%  \sumK*       |   \sum_{k = 0}^\infty
%  \sumK{r}     |   \sum_{r = 1}^\infty
%  \sumK*{r}    |   \sum_{r = 0}^\infty
%  ----------------------------
\NewDocumentCommand\sumK{s G{k}}{%
    \sum_{#2 = \IfBooleanTF{#1}{1}{0}}^\infty
}

% Same with this one...
%
%  Input        |    Output
%  ----------------------------
%  \sumI        |   \sum_{i = 1}^\infty
%  \sumI*       |   \sum_{i = 0}^\infty
%  \sumI{r}     |   \sum_{r = 1}^\infty
%  \sumI*{r}    |   \sum_{r = 0}^\infty
%  ----------------------------
\NewDocumentCommand\sumI{s G{i}}{%
    \sum_{#2 = \IfBooleanTF{#1}{1}{0}}^\infty
}

% Defines a sum over the integers
%
%  Input        |    Output
%  ----------------------------
%  \sumZ        |   \sum_{n = -\infty}^\infty
%  \sumZ{i}     |   \sum_{i = -\infty}^\infty
%  \sumZ*       |   \sum_{n = 0}^\infty
%  \sumZ*{i}    |   \sum_{i = 0}^\infty
%  ----------------------------
\NewDocumentCommand\sumZ{s G{n}}{%
    \sum_{#2 = \IfBooleanTF{#1}{0}{-\infty}}^\infty
}

% ==============================================================================
%          Integrals
% ==============================================================================

\DeclareDocumentCommand{\intN}{s}{%
    % Defines how to integrate over N
    \int_{\IfBooleanTF{#1}{1}{0}}^{\infty}
}

\newcommand{\intR}{\int\limits_{-\infty}^{\infty}}
% Very useful for placing integral limits BELOW the integral 
%
%     Input                   |   Output
% ----------------------------|-----------------
%    \int_heeeeeeey} 5 dx |   |  \int           5 dx
%                             |      heeeeeeeey
%                             |
%    \int\clp{heeeeeeey} 5 dx |      \int 5 dx
%                             |   heeeeeeeey
% ----------------------------|-----------------
\newcommand{\clp}[1]{\limits_{\mathclap{#1}}}


% ==============================================================================
%           Functions
% ==============================================================================

% Short form for writing function domains. Examples:
%
%  Input        |    Output
%  ----------------------------
%  \fun         |    f : R -> R
%  \fun{W}      |    f : W -> W
%  \fun[g]      |    g : R -> R
%  \fun[g]{Y}   |    g : Y -> Y
%  \fun[g]{Y}{X}|    g : Y -> X
%  \funR        |    f : \mathbf{R} -> \mathbf{R}
%  \funC        |    f : \mathbf{C} -> \mathbf{C}
%  \funC        |    f : \mathbf{C} -> \mathbf{C}
%  \funZ        |    f : \mathbf{Z} -> \mathbf{Z}
%  \funZ        |    f : X          -> X
%  ----------------------------
\DeclareDocumentCommand{\fun}{O{f} G{\mathbb{R}} G{#2}}{%
    #1\colon#2\to#3
}
\DeclareDocumentCommand{\funR}{O{f}}{%
    \fun[#1]{\mathbb{R}}
}
\DeclareDocumentCommand{\funC}{O{f}}{%
    \fun[#1]{\mathbb{C}}
}
\DeclareDocumentCommand{\funN}{O{f}}{%
    \fun[#1]{\mathbb{N}}
}
\DeclareDocumentCommand{\funZ}{O{f}}{%
    \fun[#1]{\mathbb{Z}}
}
\DeclareDocumentCommand{\funQ}{O{f}}{%
    \fun[#1]{\mathbb{Q}}
}
\DeclareDocumentCommand{\funX}{O{f}}{%
    \fun[#1]{X}
}

% ==============================================================================
%          System of equations
% ==============================================================================

\usepackage{systeme}

\sysdelim..

\makeatletter
\def\SYS@makesyspreamble@i#1{%
  \ifnum#1<\SYS@preamblenum
    \SYS@addtotok\SYS@systempreamble{\hfil$##$&\hfil$##$&}% 
    \expandafter\SYS@makesyspreamble@i\expandafter{\number\numexpr#1+\@ne\expandafter}%
  \else
    \SYS@addtotok\SYS@systempreamble{\hfil$##$&$##$&\hfil$##$\null}% 
    \ifSYS@extracol
      \SYS@addtotok\SYS@systempreamble{&\SYS@extracolstart##\SYS@extracolend\hfil\null}% 
    \fi
    \SYS@addtotok\SYS@systempreamble{\cr\SYS@strutup}% 
  \fi
}
\makeatother

% ==============================================================================
%          Cases environment
% ==============================================================================
%
% Definition of the cases environment that accepts one optional 
% argument, the column specification of the left column. Thus 
% writing \begin{cases}[r] the left column is set right-aligned.
%
% See https://tex.stackexchange.com/a/124762/8306 for more examples.

\makeatletter
\renewenvironment{cases}[1][l]{\matrix@check\cases\env@cases{#1}}{\endarray\right.}
\def\env@cases#1{%
  \let\@ifnextchar\new@ifnextchar
  \left\lbrace\def\arraystretch{1.2}%
  \array{@{}#1@{\quad}l@{}}}
\makeatother

% ==============================================================================
%          Misc
% ==============================================================================
%
%  Use a command often, but does not quite fit in elsewhere? Place it here

% Mostly used in matrices and equations to imitate the spacing of the - symbol
% Useful for alignment: 
%  
%  \begin{matrix}
%       1 &     -   2
%       1 &  \minus 3
%  \end{matrix}
\newcommand{\minus}{\phantom{-}}

% This defines x^2 + y^2 for \squares and x^2 + y^2 + z^2 for \squares*
\DeclareDocumentCommand{\squares}{s O{2} G{x} G{y} G{z}}{%
    #3^#2 + #4^#2 + \IfBooleanT{#1}{#5^#2}
}
